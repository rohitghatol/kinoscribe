<!--
Copyright (c) 2014 Synerzip. All rights reserved.
This code may only be used under the Apache 2.0 style license found at http://www.apache.org/licenses/LICENSE-2.0
Code distributed by Synerzip as part of its showcase apps built on Polymer https://github.com/Synerzip/kinoscribe
-->

<link rel="import" href="../polymer/polymer.html">


<!--
Element providing solution to creating impress.js like slideshow in browser

##### Example

    <kino-pres>
        <kino-slide x="100" y="100" z="-100" rotateX="30" rotateY="30" rotateZ="0" scale=3">
            <section>
               Slide 1
             </section>
        </kino-slide>
        <kino-slide x="200" y="200" z="-200" rotateX="60" rotateY="60" rotateZ="50" scale=5">
             <section>
               Slide 2
             </section>
        </kino-slide>
        ....
    </kino-pres>


@element kino-pres
@blurb Element providing solution to creating impress.js like slideshow in browser
@status alpha
@homepage http://github.com/Synerzip/kinoscribe
-->
<polymer-element name="kino-pres" attributes="currentSlide slides transition">

<template>

    <style>
        :host {

        }
        #preso{
            position: absolute;
            left: 50%;
            top: 50%;
        }
    </style>
    <kino-transition-default id="defaultTransition"></kino-transition-default>
    <article id="preso">
        <section id="container">
            <content select="kino-slide"></content>
        </section>
    </article>

</template>
<script src="style.js"></script>
<script>

    Polymer('kino-pres', {
        /**
         * Current slide being shown
         *
         * @attribute currentSlide
         * @type num
         * @defaultValue 1
         */
        currentSlide: 1,
        /**
         * Total number of slides
         *
         * @property slides
         * @type num
         */
        slides: 0,
        /**
         * All the Transition slideTransitions for KinoScribe Presentation
         *
         *
         *
         */
        slideTransitions: [],

        /**
         */
        initialized:false,
        /**
         * Slide Transition
         * @attribute transition
         * @type string
         */
        transition:"kino-transition-default",
        /**
         *
         */
        config: {
            width: 1024,
            height: 768,
            maxScale: 1,
            minScale: 0,
            perspective: 1000,
            transitionDuration: 1000
        },

        transitionChanged:function(oldValue,newValue){
            if(this.initialized){
                this.render();
            }
        },
        /**
         *
         */
        attached: function () {

            var self=this;
            var css = new Style();
            css.apply(document.body,{
                overflow:"hidden",
                height:"100%"
            })
            this.init();
            this.render();
        },

        init:function(){
            var self = this;
            document.addEventListener("keydown", function (event) {
                //On Left Arrow
                if (37 === event.keyCode) {
                    self.prev();
                }
                //On Right Arrow
                else if (39 === event.keyCode || 32 === event.keyCode) {
                    self.next();
                }
            }, true);
            // touch handler to detect taps on the left and right side of the screen
            // based on awesome work of @hakimel: https://github.com/hakimel/reveal.js
            document.addEventListener("touchstart", function ( event ) {
                if (event.touches.length === 1) {
                    var x = event.touches[0].clientX,
                            width = window.innerWidth * 0.3,
                            result = null;

                    if ( x < width ) {
                        self.prev();
                    } else if ( x > window.innerWidth - width ) {
                        this.next();
                    }

                    if (result) {
                        self.preventDefault();
                    }
                }
            }, false);
            // rescale presentation when window is resized
            window.addEventListener("resize", function () {
                // force going to active step again, to trigger rescaling
                self.goto(self.currentSlide);
            }, false);

            window.addEventListener("hashchange", function () {
                self.readSlideNumFromHash();
            }, false);


            self.readSlideNumFromHash();

        },

        render:function(){
            var self=this;
            var transitionElem=document.querySelector(this.transition)||this.$.defaultTransition;
            transitionElem.addEventListener("layout-ready",function(event){
                self.renderLayout(new event.detail.layout());
            });
            this.fire("layout-request",null,transitionElem);
        },
        renderLayout:function(layout){
            var nodes = this.getSlides();
            this.slides=nodes.length;
            nodes[0].active = true;
            this.slideTransitions=layout.calculateSlideTransitions(nodes);
            this.goto(this.currentSlide);
            var self=this;
            setTimeout(function(){
                self.initialized=true;
            },2000);

        },
        currentSlideChanged: function (oldValue, newValue) {
            var slides = this.getSlides();
            var prevSlide = slides[oldValue-1];
            var nextSlide = slides[newValue-1];

            this.fire("slideChanged",newValue,this);
            this.fire("enter",newValue,nextSlide);
            this.fire("exit",oldValue,prevSlide);

            this.goto(this.currentSlide);
        },
        next:function(){
            this.currentSlide = this.currentSlide>=this.slideTransitions.length ? 1 : (this.currentSlide + 1);
        },
        prev:function(){
            this.currentSlide = this.currentSlide <= 1 ? this.slideTransitions.length : (this.currentSlide - 1);
        },

        readSlideNumFromHash:function(){
            var slideNum=window.location.hash.replace(/^#\/?/,"");
            var newValue = toNumber(slideNum,this.currentSlide);
            //If use gives wrong range, move to current slide
            if(newValue>0 && newValue<=this.slides){
                this.currentSlide=newValue;
            }
            else{
                window.location.hash =   "#/" + this.currentSlide;
            }
        },
        goto: function (currentSlide) {
            window.scrollTo(0, 0);

            this.modifyRoot(currentSlide);
            this.modifyContainer(currentSlide);
        },
        modifyRoot:function(currentSlide){
            var css = new Style();
            var step = this.slideTransitions[this.currentSlide-1];


            var root = this.$.preso;
            var targetScale = inverse(step.activeScale) * this.windowScale(this.config);
            var perspectiveValue = this.config.perspective / targetScale;
            var scaleValue = targetScale;

            var transformBuilder = new TransformBuilder();
            var transform = transformBuilder
                    .perspective(perspectiveValue)
                    .scale(scaleValue)
                    .transform;


            var style={
                position:"absolute",
                transformationOrigin : "0% 0%",
                transition:"all 1000ms ease-in-out 0ms",
                top:"50%",
                left:"50%",
                transformStyle:"preserve-3d",
                transform:transform
            }
            css.apply(root,style);
        },
        modifyContainer:function(currentSlide){
            var css = new Style();
            var step = this.slideTransitions[this.currentSlide-1];

            var container = this.$.container;

            var transformBuilder = new TransformBuilder();
            var transform = transformBuilder
                    .rotate3d(negate(step.activeRotateX),negate(step.activeRotateY),negate(step.activeRotateZ),true)
                    .translate3d(negate(step.activeX),negate(step.activeY),negate(step.activeZ))
                    .transform
            var style={
                position:"absolute",
                transformationOrigin : "0% 0%",
                transition:"all 1000ms ease-in-out 0ms",
                transformStyle:"preserve-3d",
                transform:transform
            }
            css.apply(container,style);

        },

        windowScale: function (config) {
            var hScale = window.innerHeight / config.height,
                    wScale = window.innerWidth / config.width,
                    scale = hScale > wScale ? wScale : hScale;

            if (config.maxScale && scale > config.maxScale) {
                scale = config.maxScale;
            }

            if (config.minScale && scale < config.minScale) {
                scale = config.minScale;
            }

            return scale;
        },

        getSlideCount:function(){
            return this.$.container.children!=null?this.$.container.children[0].getDistributedNodes().length:0;
        },
        getSlides: function () {
            return this.$.container.children!=null?this.$.container.children[0].getDistributedNodes():[];
        },

        getSlide:function(index){
            return getSlides()[index];
        }
    });

</script>

</polymer-element>


<!--
Element providing solution to creating slides under kino-pres web component

##### Example

    <kino-pres>
        <kino-slide x="100" y="100" z="-100" rotateX="30" rotateY="30" rotateZ="0" scale=3">
            <section>
               Slide 1
             </section>
        </kino-slide>
        <kino-slide x="200" y="200" z="-200" rotateX="60" rotateY="60" rotateZ="50" scale=5">
             <section>
               Slide 2
             </section>
        </kino-slide>
        ....
    </kino-pres>


@element kino-slide
@blurb Element providing solution to creating slides under kino-pres element
@status alpha
@homepage http://github.com/Synerzip/kinoscribe
-->

<polymer-element name="kino-slide" attributes="x y z rotateX rotateY rotateZ scale active activeX activeY activeZ activeRotateX activeRotateY activeRotateZ activeScale">

    <template>

        <style>
            :host {
            }

            #slide {
                position: relative;

            }

            .active {
                opacity: 1;
                -webkit-transition: 200ms ease-in-out 100ms;

            }

            .inactive {
                opacity: 0.2;

                -webkit-transition: 2000ms ease-in-out 100ms;

            }

            ::content layout {
                width: 100%;
                height: 100%;
            }
        </style>

        <section id="slide" class="{{active==true?'active':'inactive'}}">
            <content></content>
        </section>

    </template>
    <script src="style.js"></script>
    <script>


        Polymer('kino-slide', {


            /**
             * The `x` position of the slide on the 3D Presentation Canvas
             *
             * @attribute x
             * @type num
             * @default 0
             */
            x: 0,



            /**
             * The `y` position of the slide on the 3D Presentation Canvas
             *
             * @attribute y
             * @type num
             * @default 0
             */
            y: 0,



            /**
             * The `z` position of the slide on the 3D Presentation Canvas
             *
             * @attribute z
             * @type num
             * @default 0
             */
            z: 0,


            /**
             * The angle of rotation along 'x' axis of the slide on the 3D Presentation Canvas
             *
             * @attribute rotateX
             * @type num
             * @default 0
             */
            rotateX: 0,



            /**
             * The angle of rotation along 'y' axis of the slide on the 3D Presentation Canvas
             *
             * @attribute rotateY
             * @type num
             * @default 0
             */
            rotateY: 0,


            /**
             * The angle of rotation along 'z' axis of the slide on the 3D Presentation Canvas
             *
             * @attribute rotateZ
             * @type num
             * @default 0
             */
            rotateZ: 0,


            /**
             * The magnification scale of this slide
             *
             * @attribute scale
             * @type num
             * @default 1
             */
            scale: 1,


            /**
             * The `x` position of the slide when selected
             *
             * @attribute activeX
             * @type num
             * @default 0
             */
            activeX: null,

            /**
             * The `y` position of the slide when selected
             *
             * @attribute activeY
             * @type num
             * @default 0
             */
            activeY: null,

            /**
             * The `z` position of the slide when selected
             *
             * @attribute activeZ
             * @type num
             * @default 0
             */
            activeZ: null,

            /**
             * The angle of rotation along 'x' axis of the slide when selected
             *
             * @attribute activeRotateX
             * @type num
             * @default 0
             */
            activeRotateX: null,

            /**
             * The angle of rotation along 'y' axis of the slide when selected
             *
             * @attribute activeRotateY
             * @type num
             * @default 0
             */
            activeRotateY: null,


            /**
             * The angle of rotation along 'z' axis of the slide when selected
             *
             * @attribute activeRotateZ
             * @type num
             * @default 0
             */
            activeRotateZ: null,

            /**
             * The magnification scale when selected
             *
             * @attribute activeScale
             * @type num
             * @default 0
             */
            activeScale: null,

            /**
             * Indication of this slide being the Active/Current Slide being shown
             *
             * @attribute active
             * @type bool
             * @default false
             */
            active: false,
            attributeChanged: function(attrName, oldValue, newValue) {
                if(attrName!='active'){
                    this.render();
                }
            },


            domReady: function () {
                var self=this;
                this.init();
                this.render();

                this.addEventListener("enter",function(event){
                    this.active=true;
                    window.location.hash =   "#/" + toNumber(event.detail);
                    self.renderActive();
                });
                this.addEventListener("exit",function(event){
                    this.active=false;
                    self.render();
                });
            },
            init:function(){
                this.activeX=this.activeX||this.x;
                this.activeY=this.activeY||this.y;
                this.activeZ=this.activeZ||this.z;

                this.activeRotateX=this.activeRotateX||this.rotateX;
                this.activeRotateY=this.activeRotateY||this.rotateY;
                this.activeRotateZ=this.activeRotateZ||this.rotateZ;

                this.activeScale = this.activeScale||this.scale;



            },
            render:function(){
                var slide = this.$.slide;

                var css = new Style();
                var transformBuilder = new TransformBuilder();

                var style={
                    position:"absolute",
                    transformStyle:"preserve-3d",
                    transform:transformBuilder
                            .translate("-50%","-50%")
                            .translate3d(this.x,this.y,this.z)
                            .rotate3d(this.rotateX,this.rotateY,this.rotateZ)
                            .scale(this.scale)
                            .transform
                }
                css.apply(slide,style);
            },
            renderActive:function(){
                var slide = this.$.slide;

                var css = new Style();
                var transformBuilder = new TransformBuilder();

                var style={
                    position:"absolute",
                    transformStyle:"preserve-3d",
                    transform:transformBuilder
                            .translate("-50%","-50%")
                            .translate3d(this.activeX,this.activeY,this.activeZ)
                            .rotate3d(this.activeRotateX,this.activeRotateY,this.activeRotateZ)
                            .scale(this.activeScale)
                            .transform
                }
                css.apply(slide,style);
            }
        });
    </script>

</polymer-element>





<polymer-element name="kino-transition-default" on-layout-request="{{onLayoutRequest}}">

    <template>
        <style>
            :host{
                display:none;
            }
        </style>
    </template>

    <script>
        Polymer('kino-transition-default', {
            onLayoutRequest:function(){
                this.fire("layout-ready",{"layout":this.layoutProvider()});
            },
            layoutProvider:function(){
                var layout = function(){
                    this.calculateSlideTransitions=function(slides){

                        var slideTransitions=[];

                        for (var index = 0; index < slides.length; index++) {
                            var slide = slides[index];
                            var step = {
                                x: 0, y: 0, z: 0,
                                rotateX: 0, rotateY: 0, rotateZ: 0,
                                scale: 1,
                                activeX: 0, activeY: 0, activeZ: 0,
                                activeRotateX: 0, activeRotateY: 0, activeRotateZ: 0,
                                activeScale: 1
                            };
                            if (slide.attributes.x != null) {
                                step.x = toNumber(slide.attributes.x.value);
                            }
                            if (slide.attributes.y != null) {
                                step.y = toNumber(slide.attributes.y.value);
                            }
                            if (slide.attributes.z != null) {
                                step.z = toNumber(slide.attributes.z.value);
                            }
                            if (slide.attributes.rotateZ != null) {
                                step.rotateZ = toNumber(slide.attributes.rotateZ.value);
                            }
                            if (slide.attributes.rotateY != null) {
                                step.rotateY = toNumber(slide.attributes.rotateY.value);
                            }
                            if (slide.attributes.rotateX != null) {
                                step.rotateX = toNumber(slide.attributes.rotateX.value);
                            }
                            if (slide.attributes.scale != null) {
                                step.scale = toNumber(slide.attributes.scale.value, 1);
                            }
                            step.activeX=step.x;
                            step.activeY=step.y;
                            step.activeZ=step.z;
                            step.activeRotateX=step.rotateX;
                            step.activeRotateY=step.rotateY;
                            step.activeRotateZ=step.rotateZ;
                            step.activeScale=step.scale;


                            if (slide.attributes.activeX != null) {
                                step.activeX = toNumber(slide.attributes.activeX.value);
                            }
                            if (slide.attributes.activeY != null) {
                                step.activeY = toNumber(slide.attributes.activeY.value);
                            }
                            if (slide.attributes.activeZ != null) {
                                step.activeZ = toNumber(slide.attributes.activeZ.value);
                            }
                            if (slide.attributes.activeRotateZ != null) {
                                step.activeRotateZ = toNumber(slide.attributes.activeRotateZ.value);
                            }
                            if (slide.attributes.activeRotateY != null) {
                                step.activeRotateY = toNumber(slide.attributes.activeRotateY.value);
                            }
                            if (slide.attributes.activeRotateX != null) {
                                step.activeRotateX = toNumber(slide.attributes.activeRotateX.value);
                            }
                            if (slide.attributes.activeScale != null) {
                                step.activeScale = toNumber(slide.attributes.activeScale.value, 1);
                            }

                            slideTransitions[index] = step;
                        }

                        return slideTransitions;
                    }
                };

                return layout;
            }
        });
    </script>
</polymer-element>



<polymer-element name="kino-transition-left-to-right" extends="kino-transition-default">

    <template>
        <style>
            :host{
                display:none;
            }
        </style>
    </template>

    <script>
        Polymer('kino-transition-left-to-right', {

            layoutProvider:function(){
                var dimension = function(slide){
                    var dim = {
                        width:0,
                        height:0
                    };
                    for(var index =0;index<slide.children.length;index++){
                        dim.width+=slide.children[index].offsetWidth;
                        dim.height+=slide.children[index].offsetHeight;
                    }
                    return dim;
                }
                var layout = function(){

                    this.calculateSlideTransitions=function(slides){

                        var slideTransitions=[];

                        var lastWidth=0;
                        for (var index = 0; index < slides.length; index++) {
                            var slide = slides[index];

                            var dim = dimension(slide);

                            lastWidth+=dim.width;
                            var step = {
                                x: lastWidth, y: 0, z: 0,
                                rotateX: 0, rotateY: 0, rotateZ: 0,
                                scale: 1,
                                activeX:lastWidth,activeY:0, activeZ:0,
                                activeRotateX:0,activeRotateY:0, activeRotateZ:0,
                                activeScale:1
                            };
                            slide.setAttribute('x',step.x);
                            slide.setAttribute('y',step.y);
                            slide.setAttribute('z',step.z);
                            slide.setAttribute('rotateX',step.rotateX);
                            slide.setAttribute('rotateY',step.rotateY);
                            slide.setAttribute('rotateZ',step.rotateZ);
                            slide.setAttribute('scale',step.scale);

                            slide.setAttribute('activeX',step.activeX);
                            slide.setAttribute('activeY',step.activeY);
                            slide.setAttribute('activeZ',step.activeZ);
                            slide.setAttribute('activeRotateX',step.activeRotateX);
                            slide.setAttribute('activeRotateY',step.activeRotateY);
                            slide.setAttribute('activeRotateZ',step.activeRotateZ);
                            slide.setAttribute('activeScale',step.activeScale);



                            slideTransitions[index] = step;
                        }

                        return slideTransitions;
                    }
                };

                return layout;
            }
        });
    </script>
</polymer-element>


<polymer-element name="kino-transition-left-to-right-emphasis" extends="kino-transition-default">

    <template>
        <style>
            :host{
                display:none;
            }
        </style>
    </template>

    <script>
        Polymer('kino-transition-left-to-right-emphasis', {

            layoutProvider:function(){
                var dimension = function(slide){
                    var dim = {
                        width:0,
                        height:0
                    };
                    for(var index =0;index<slide.children.length;index++){
                        dim.width+=slide.children[index].offsetWidth;
                        dim.height+=slide.children[index].offsetHeight;
                    }
                    return dim;
                }
                var layout = function(){

                    this.calculateSlideTransitions=function(slides){

                        var slideTransitions=[];

                        var lastWidth=0;
                        for (var index = 0; index < slides.length; index++) {
                            var slide = slides[index];

                            var dim = dimension(slide);

                            lastWidth+=dim.width;
                            var step = {
                                x: lastWidth, y: 0, z: 0,
                                rotateX: 0, rotateY: 0, rotateZ: 0,
                                scale: 1,
                                activeX:lastWidth,activeY:0, activeZ:0,
                                activeRotateX:0,activeRotateY:0, activeRotateZ:0,
                                activeScale:1.2
                            };
                            slide.setAttribute('x',step.x);
                            slide.setAttribute('y',step.y);
                            slide.setAttribute('z',step.z);
                            slide.setAttribute('rotateX',step.rotateX);
                            slide.setAttribute('rotateY',step.rotateY);
                            slide.setAttribute('rotateZ',step.rotateZ);
                            slide.setAttribute('scale',step.scale);

                            slide.setAttribute('activeX',step.activeX);
                            slide.setAttribute('activeY',step.activeY);
                            slide.setAttribute('activeZ',step.activeZ);
                            slide.setAttribute('activeRotateX',step.activeRotateX);
                            slide.setAttribute('activeRotateY',step.activeRotateY);
                            slide.setAttribute('activeRotateZ',step.activeRotateZ);
                            slide.setAttribute('activeScale',step.activeScale);



                            slideTransitions[index] = step;
                        }

                        return slideTransitions;
                    }
                };

                return layout;
            }
        });
    </script>
</polymer-element>




<polymer-element name="kino-transition-top-to-bottom" extends="kino-transition-default">

    <template>
        <style>
            :host{
                display:none;
            }
        </style>
    </template>

    <script>
        Polymer('kino-transition-top-to-bottom', {

            layoutProvider:function(){
                var dimension = function(slide){
                    var dim = {
                        width:0,
                        height:0
                    };
                    for(var index =0;index<slide.children.length;index++){
                        dim.width+=slide.children[index].offsetWidth;
                        dim.height+=slide.children[index].offsetHeight;
                    }
                    return dim;
                }
                var layout = function(){

                    this.calculateSlideTransitions=function(slides){

                        var slideTransitions=[];

                        var lastHeight=0;
                        for (var index = 0; index < slides.length; index++) {
                            var slide = slides[index];

                            var dim = dimension(slide);

                            lastHeight+=dim.height;
                            var step = {
                                x: 0, y: lastHeight, z: 0,
                                rotateX: 0, rotateY: 0, rotateZ: 0,
                                scale: 1,
                                activeX:0,activeY:lastHeight, activeZ:0,
                                activeRotateX:0,activeRotateY:0, activeRotateZ:0,
                                activeScale:1
                            };
                            slide.setAttribute('x',step.x);
                            slide.setAttribute('y',step.y);
                            slide.setAttribute('z',step.z);
                            slide.setAttribute('rotateX',step.rotateX);
                            slide.setAttribute('rotateY',step.rotateY);
                            slide.setAttribute('rotateZ',step.rotateZ);
                            slide.setAttribute('scale',step.scale);

                            slide.setAttribute('activeX',step.activeX);
                            slide.setAttribute('activeY',step.activeY);
                            slide.setAttribute('activeZ',step.activeZ);
                            slide.setAttribute('activeRotateX',step.activeRotateX);
                            slide.setAttribute('activeRotateY',step.activeRotateY);
                            slide.setAttribute('activeRotateZ',step.activeRotateZ);
                            slide.setAttribute('activeScale',step.activeScale);

                            slideTransitions[index] = step;
                        }

                        return slideTransitions;
                    }
                };

                return layout;
            }
        });
    </script>
</polymer-element>




<polymer-element name="kino-transition-top-to-bottom-emphasis" extends="kino-transition-default">

    <template>
        <style>
            :host{
                display:none;
            }
        </style>
    </template>

    <script>
        Polymer('kino-transition-top-to-bottom-emphasis', {

            layoutProvider:function(){
                var dimension = function(slide){
                    var dim = {
                        width:0,
                        height:0
                    };
                    for(var index =0;index<slide.children.length;index++){
                        dim.width+=slide.children[index].offsetWidth;
                        dim.height+=slide.children[index].offsetHeight;
                    }
                    return dim;
                }
                var layout = function(){

                    this.calculateSlideTransitions=function(slides){

                        var slideTransitions=[];

                        var lastHeight=0;
                        for (var index = 0; index < slides.length; index++) {
                            var slide = slides[index];

                            var dim = dimension(slide);

                            lastHeight+=dim.height;
                            var step = {
                                x: 0, y: lastHeight, z: 0,
                                rotateX: 0, rotateY: 0, rotateZ: 0,
                                scale: 1,
                                activeX:0,activeY:lastHeight, activeZ:0,
                                activeRotateX:0,activeRotateY:0, activeRotateZ:0,
                                activeScale:1.2
                            };
                            slide.setAttribute('x',step.x);
                            slide.setAttribute('y',step.y);
                            slide.setAttribute('z',step.z);
                            slide.setAttribute('rotateX',step.rotateX);
                            slide.setAttribute('rotateY',step.rotateY);
                            slide.setAttribute('rotateZ',step.rotateZ);
                            slide.setAttribute('scale',step.scale);

                            slide.setAttribute('activeX',step.activeX);
                            slide.setAttribute('activeY',step.activeY);
                            slide.setAttribute('activeZ',step.activeZ);
                            slide.setAttribute('activeRotateX',step.activeRotateX);
                            slide.setAttribute('activeRotateY',step.activeRotateY);
                            slide.setAttribute('activeRotateZ',step.activeRotateZ);
                            slide.setAttribute('activeScale',step.activeScale);

                            slideTransitions[index] = step;
                        }

                        return slideTransitions;
                    }
                };

                return layout;
            }
        });
    </script>
</polymer-element>


<polymer-element name="kino-transition-box" extends="kino-transition-default">

    <template>
        <style>
            :host{
                display:none;
            }
        </style>
    </template>

    <script>
        Polymer('kino-transition-box', {

            layoutProvider:function(){
                var dimension = function(slide){
                    var dim = {
                        width:0,
                        height:0
                    };
                    for(var index =0;index<slide.children.length;index++){
                        dim.width+=slide.children[index].offsetWidth;
                        dim.height+=slide.children[index].offsetHeight;
                    }
                    return dim;
                }
                var layout = function(){

                    this.calculateSlideTransitions=function(slides){

                        var slideTransitions=[];
                        var lastX=0
                        var lastY=0;
                        var lastZ=0;
                        var lastRotateX=0;
                        var lastRotateY=0;
                        var lastRotateZ=0;

                        var funcX=function(index,dim){
                            var face = index%4;
                            if(face==0){
                                return 0;
                            }
                            if(face==1){
                                return dim.width/2;
                            }
                            if(face==2){
                                return 1 ;
                            }
                            if(face==3){
                                return -1 * dim.width/2;
                            }
                            return 0;
                        }

                        var funcZ=function(index,dim){
                            var face = index%4;
                            if(face==0){
                                return dim.width/2;
                            }
                            if(face==1){
                                return 0;
                            }
                            if(face==2){
                                return -1 * dim.width/2;
                            }
                            if(face==3){
                                return 0 ;
                            }
                            return 0;
                        }

                        var funcRotateY=function(index,dim){
                            return index*90;
                        }

                        for (var index = 0; index < slides.length; index++) {

                            var slide = slides[index];
                            var dim = dimension(slide);


                            var step = {
                                x:funcX(index,dim),
                                y: 0,
                                z: funcZ(index,dim),
                                rotateX: 0,
                                rotateY: funcRotateY(index,dim),
                                rotateZ: 0,
                                scale: 1,
                                activeX:funcX(index,dim),
                                activeY: 0,
                                activeZ: funcZ(index,dim),
                                activeRotateX: 0,
                                activeRotateY: funcRotateY(index,dim),
                                activeRotateZ: 0,
                                activeScale: 1.1

                            };
                            slide.setAttribute('x',step.x);
                            slide.setAttribute('y',step.y);
                            slide.setAttribute('z',step.z);
                            slide.setAttribute('rotateX',step.rotateX);
                            slide.setAttribute('rotateY',step.rotateY);
                            slide.setAttribute('rotateZ',step.rotateZ);
                            slide.setAttribute('scale',step.scale);

                            slide.setAttribute('activeX',step.activeX);
                            slide.setAttribute('activeY',step.activeY);
                            slide.setAttribute('activeZ',step.activeZ);
                            slide.setAttribute('activeRotateX',step.activeRotateX);
                            slide.setAttribute('activeRotateY',step.activeRotateY);
                            slide.setAttribute('activeRotateZ',step.activeRotateZ);
                            slide.setAttribute('activeScale',step.activeScale);


                            slideTransitions[index] = step;


                        }

                        return slideTransitions;
                    }
                };

                return layout;
            }
        });
    </script>
</polymer-element>


<polymer-element name="kino-transition-3d-spiral" extends="kino-transition-default">

    <template>
        <style>
            :host{
                display:none;
            }
        </style>
    </template>

    <script>
        Polymer('kino-transition-3d-spiral', {

            layoutProvider:function(){
                var dimension = function(slide){
                    var dim = {
                        width:0,
                        height:0
                    };
                    for(var index =0;index<slide.children.length;index++){
                        dim.width+=slide.children[index].offsetWidth;
                        dim.height+=slide.children[index].offsetHeight;
                    }
                    return dim;
                }
                var layout = function(){

                    this.calculateSlideTransitions=function(slides){

                        var slideTransitions=[];
                        var lastX=0
                        var lastY=0;
                        var lastZ=0;
                        var lastRotateX=0;
                        var lastRotateY=0;
                        var lastRotateZ=0;

                        var funcX=function(index,dim){
                            var face=index%4;
                            if(face==0){
                                return 0;
                            }
                            if(face==1){
                                return dim.width/2;
                            }
                            if(face==2){
                                return 0;
                            }
                            if(face==3){
                                return -1 * dim.width/2;
                            }
                            return 0;
                        }
                        var funcY=function(index,dim){
                            return index*(dim.height/2)

                        }
                        var funcZ=function(index,dim){
                            var face = index % 4;
                            if(face==0){
                                return dim.width/2;
                            }
                            if(face==1){
                                return 0;
                            }
                            if(face==2){
                                return -1 * dim.width/2;
                            }
                            if(face==3){
                                return 0 ;
                            }
                            return 0;
                        }

                        var funcRotateY=function(index,dim){
                            return index*90;
                        }

                        for (var index = 0; index < slides.length; index++) {

                            var slide = slides[index];

                            var dim = dimension(slide);


                            var step = {
                                x:funcX(index,dim),
                                y: funcY(index,dim),
                                z: funcZ(index,dim),
                                rotateX: 0,
                                rotateY: funcRotateY(index,dim),
                                rotateZ: 0,
                                scale: 1,
                                activeX:funcX(index,dim),
                                activeY: funcY(index,dim),
                                activeZ: funcZ(index,dim),
                                activeRotateX: 0,
                                activeRotateY: funcRotateY(index,dim),
                                activeRotateZ: 0,
                                activeScale: 1.1
                            };
                            slide.setAttribute('x',step.x);
                            slide.setAttribute('y',step.y);
                            slide.setAttribute('z',step.z);
                            slide.setAttribute('rotateX',step.rotateX);
                            slide.setAttribute('rotateY',step.rotateY);
                            slide.setAttribute('rotateZ',step.rotateZ);
                            slide.setAttribute('scale',step.scale);

                            slide.setAttribute('activeX',step.activeX);
                            slide.setAttribute('activeY',step.activeY);
                            slide.setAttribute('activeZ',step.activeZ);
                            slide.setAttribute('activeRotateX',step.activeRotateX);
                            slide.setAttribute('activeRotateY',step.activeRotateY);
                            slide.setAttribute('activeRotateZ',step.activeRotateZ);
                            slide.setAttribute('activeScale',step.activeScale);


                            slideTransitions[index] = step;


                        }

                        return slideTransitions;
                    }
                };

                return layout;
            }
        });
    </script>
</polymer-element>


<polymer-element name="kino-transition-file-cabinet" extends="kino-transition-default">

    <template>
        <style>
            :host{
                display:none;
            }
        </style>
    </template>

    <script>
        Polymer('kino-transition-file-cabinet', {

            layoutProvider:function(){
                var dimension = function(slide){
                    var dim = {
                        width:0,
                        height:0
                    };
                    for(var index =0;index<slide.children.length;index++){
                        dim.width+=slide.children[index].offsetWidth;
                        dim.height+=slide.children[index].offsetHeight;
                    }
                    return dim;
                }
                var layout = function(){

                    this.calculateSlideTransitions=function(slides){

                        var slideTransitions=[];
                        var lastX=0
                        var lastY=0;
                        var lastZ=0;
                        var lastRotateX=0;
                        var lastRotateY=0;
                        var lastRotateZ=0;

                        var funcX=function(index,dim){
                            return index * 100;
                        }
                        var funcRotateY=function(index,dim){
                            return 90;
                        }
                        var funcActiveRotateY=function(index,dim){
                            return 0;
                        }
                        var funcActiveZ=function(index,dim){
                            return dim.width/2;
                        }

                        for (var index = 0; index < slides.length; index++) {

                            var slide = slides[index];

                            var dim = dimension(slide);


                            var step = {
                                x:funcX(index,dim),
                                y: 0,
                                z: 0,
                                rotateX: 0,
                                rotateY: funcRotateY(index),
                                rotateZ: 0,
                                scale: 1,
                                activeX:funcX(index,dim),
                                activeY: 0,
                                activeZ: funcActiveZ(index,dim),
                                activeRotateX: 0,
                                activeRotateY: funcActiveRotateY(index,dim),
                                activeRotateZ: 0,
                                activeScale: 1
                            };
                            slide.setAttribute('x',step.x);
                            slide.setAttribute('y',step.y);
                            slide.setAttribute('z',step.z);
                            slide.setAttribute('rotateX',step.rotateX);
                            slide.setAttribute('rotateY',step.rotateY);
                            slide.setAttribute('rotateZ',step.rotateZ);
                            slide.setAttribute('scale',step.scale);

                            slide.setAttribute('activeX',step.activeX);
                            slide.setAttribute('activeY',step.activeY);
                            slide.setAttribute('activeZ',step.activeZ);
                            slide.setAttribute('activeRotateX',step.activeRotateX);
                            slide.setAttribute('activeRotateY',step.activeRotateY);
                            slide.setAttribute('activeRotateZ',step.activeRotateZ);
                            slide.setAttribute('activeScale',step.activeScale);


                            slideTransitions[index] = step;


                        }

                        return slideTransitions;
                    }
                };

                return layout;
            }
        });
    </script>
</polymer-element>
